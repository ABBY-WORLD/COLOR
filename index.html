<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Realistic RYB Paint Mixer</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; cursor: crosshair; }
    </style>
</head>
<body>
<canvas id="paintCanvas"></canvas>
<script>
const canvas = document.getElementById('paintCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const colors = {
    red: [255, 0, 0],
    yellow: [255, 255, 0],
    blue: [0, 0, 255],
    white: [255, 255, 255]
};

let currentMix = [];
let painting = false;

const piles = [
    { x: 50, y: 50, color: 'red' },
    { x: 150, y: 50, color: 'yellow' },
    { x: 250, y: 50, color: 'blue' },
    { x: 350, y: 50, color: 'white' }
];

function drawPiles() {
    piles.forEach(pile => {
        ctx.fillStyle = `rgb(${colors[pile.color].join(',')})`;
        ctx.beginPath();
        ctx.arc(pile.x, pile.y, 30, 0, Math.PI * 2);
        ctx.fill();
    });
}

drawPiles();

canvas.addEventListener('mousedown', e => {
    piles.forEach(pile => {
        const dx = e.clientX - pile.x;
        const dy = e.clientY - pile.y;
        if (dx * dx + dy * dy <= 30 * 30) {
            currentMix.push(pile.color);
        }
    });
    painting = true;
});

canvas.addEventListener('mouseup', () => {
    painting = false;
});

canvas.addEventListener('mousemove', e => {
    if (!painting || currentMix.length === 0) return;

    const pixel = ctx.getImageData(e.clientX, e.clientY, 1, 1).data;
    let existingRGB = [pixel[0], pixel[1], pixel[2]];

    let mixedColor = getMixedColor(existingRGB, currentMix);

    ctx.fillStyle = `rgba(${mixedColor.join(',')},0.8)`;
    ctx.beginPath();
    ctx.arc(e.clientX, e.clientY, 20, 0, Math.PI * 2);
    ctx.fill();
});

function getMixedColor(baseColor, mixArray) {
    const rybMixMap = {
        'red-yellow': [255, 165, 0],
        'yellow-blue': [50, 205, 50],
        'red-blue': [128, 0, 128],
        'red-white': [255, 128, 128],
        'yellow-white': [255, 255, 180],
        'blue-white': [128, 128, 255],
        'red-yellow-blue': [120, 80, 40]
    };

    let blended = [...baseColor];
    mixArray.forEach(colorKey => {
        const baseKey = identifyClosestColor(blended);
        let key = [baseKey, colorKey].sort().join('-');

        let mixedColor = rybMixMap[key];
        if (mixedColor) {
            blended = mixedColor;
        } else {
            blended = [
                (blended[0] + colors[colorKey][0]) / 2,
                (blended[1] + colors[colorKey][1]) / 2,
                (blended[2] + colors[colorKey][2]) / 2
            ];
        }
    });

    return blended.map(v => Math.floor(v));
}

function identifyClosestColor(rgb) {
    let closest = null;
    let closestDistance = Infinity;
    for (let key in colors) {
        let color = colors[key];
        let distance = Math.sqrt(
            (rgb[0] - color[0]) ** 2 +
            (rgb[1] - color[1]) ** 2 +
            (rgb[2] - color[2]) ** 2
        );
        if (distance < closestDistance) {
            closestDistance = distance;
            closest = key;
        }
    }
    return closest;
}

window.addEventListener('resize', () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    ctx.fillStyle = "rgb(90,90,90)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    drawPiles();
});

ctx.fillStyle = "rgb(90,90,90)";
ctx.fillRect(0, 0, canvas.width, canvas.height);
drawPiles();
</script>
</body>
</html>
